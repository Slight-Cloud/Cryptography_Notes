大家下午好，我们今天继续上课。我之前讲过，大家一个小组尽量坐在一起，这样回答问题比较方便。这门课是慕课，大家也上过不少，每个老师风格不一样，我想主要是翻转课堂。我在视频上已经把内容都讲过一遍了，所以我希望大家不是死记硬背，而是去理解，通过讨论来了解密码学与安全协议到底要处理什么问题。

我们上次课讨论过，网络从上个世纪六七十年代美国产生开始，最早是为了解决美国几个大机构、大项目（如曼哈顿计划相关的科研）的大数据传输问题。以前没有光碟、硬盘，都是打孔机，很不方便，所以科学家发明了网络来传输数据。当时目标简单，设计之初就没有考虑安全问题，就像先把路修通，事后才考虑装监控、路灯。所以网络安全可以说是事后的补丁。

假如你是一个网络用户，不论是级别很高的国家元首、部队首长，还是普通网民操作网上银行，大家希望网络提供哪些安全服务？我们计算机网络解决的是信息传递的快速、准确、廉价，而密码学要解决更高的安全要求。银行账户只认账号密码，不一定认人，所以需求不一样。

大家提到了几个需求：保密性、身份认证、不可否认性、数据可用性。我们先谈保密性。比如你和男朋友聊天，不希望别人知道。网络传输经过物理层比特流，别人为什么能看到？因为数据传输是按照TCP/IP协议进行的，协议像快递盒子，只要懂协议就能还原内容。我们不能去改协议，因为互联网是通用的，路由器、交换机都是按标准协议转发，私有协议无法在公网上跑。所以我们只能对报文内容进行处理。

这涉及到一个故事，多年前公安曾找我们做项目，想监听某些嫌疑人的通讯。我们拒绝了，原因一是涉及用户隐私和法律问题，二是像微信等应用在底层协议上有加密，且协议经常变动，破解代价太高且无法发表成果。对于一般网民，不能做协议的变化，只能对传递的数据进行加密处理。

加密就是对数据进行变换。从数学上讲，这是一个函数。变换的方法主要有三种：变换（代换）、置换（改变位置）以及两者的混合。这叫算法。为了实现加密，除了算法还需要密钥（参数）。在互联网环境下，算法能不能保密？不能。因为网民千千万，路由器交换机也要支持，不可能让每个人定义算法，所以算法必须是固化的、公开的，只有密钥是保密的。

一个好的算法要求空间资源少、效率高。如果加密让通讯延迟一小时，那就没有意义。DES算法（Data Encryption Standard）为什么经典？它利用了计算机最简单的运算——异或、查表、移位，这些运算非常快，但通过多次迭代（复合），实现了非常复杂的非线性映射。这和现在的人工智能深度学习（Deep Learning）思想是一致的。深度学习也是通过简单神经元（简单非线性函数）的层层复合，来模拟极其复杂的分类边界。DES在几十年前就运用了这种思想，既保证了安全强度，又保证了计算速度。

第二个问题是完整性。比如炒股，你卖1000股，传输中被篡改成10股，怎么保证数据不被篡改？我们需要校验。就像你收到分手短信，不确定真假，通常会打电话确认，但这在网络中代价太高。重发一遍也不行，因为黑客控制链路可以把重发的也改了。

这就用到了哈希（Hash）算法。哈希是单向函数，能把任意长度的报文变成固定长度的摘要（如128比特）。为什么用哈希？因为效率高。不管报文多大，生成哈希很快。为了防止黑客同时修改报文和哈希值，我们需要把哈希值加密后附在报文后面一起传。接收方收到后，解密得到原哈希值，再对收到的报文计算新哈希值，两者一对比，如果一致，就说明报文未被篡改。虽然王小云院士的研究表明哈希存在碰撞可能，但在实际应用中，要找到两个语义相反且哈希值相同的报文（比如“我爱你”和“分手”）概率微乎其微。

第三个问题是不可否认性。比如买了股票亏了想赖账，或者被人伪造指令。在对称加密体系中，加密和解密密钥相关（甚至相同），你能发我也能伪造，所以无法解决不可否认性。这就需要非对称密码（公开密钥体系）。

非对称密码有一对密钥：公钥和私钥。公钥公开，私钥保密。用公钥加密必须用私钥解开，反之亦然。这是密码学史上最伟大的思想，没有它这门课就讲完了。Diffie和Hellman提出了思想，RSA三位科学家设计出了算法，他们都获得了图灵奖。用私钥对报文进行处理（签名），任何人都可以用公钥解开。既然能用公钥解开，说明这一定是用你的私钥处理的，而私钥只有你有，这就实现了不可否认性（签名）。如果不想让别人看到内容，就用对方的公钥加密，这样只有对方的私钥能解开，实现了保密性。

通常我们是对原始信息的哈希值进行签名，而不是对整个信封签名。至于非对称能否代替对称算法？目前不能。因为同等安全强度下，非对称算法（涉及大数模幂运算等）比对称算法（位运算）慢约1000倍。所以我们保留对称算法用于数据加密，利用其速度快的优势；利用非对称算法解决密钥分发和签名问题。

这就构成了我们这门课的核心：机密性、完整性、不可否认性、可用性。所有协议（如https、SSL、SET协议等）都是围绕这四点设计的。

刚才有同学提到，未来随着技术发展（如椭圆曲线ECC或量子计算），非对称算法可能会变快，甚至超过现在的对称算法。这个观点很好，椭圆曲线确实提高了效率，量子计算可能会带来全新的架构。但在现有体系下，速度差异依然存在，所以混合使用是主流。

今天我们把原理和框架讲了，下节课我们会深入细节，希望大家认真看PPT和视频，把知识融会贯通。
